<img width="2879" height="1700" alt="image" src="https://github.com/user-attachments/assets/ff2199ca-45b7-43f5-a146-2680b53c5f0f" />

# GOROCKET Control Suite

고로켓 팀의 액체 로켓 엔진을 **유선 시리얼 포트**로 제어하기 위한 데스크톱 애플리케이션입니다. 이 프로그램은 실험실이나 개인 개발 PC에서만 사용되는 **개발 도구**로, 배포용 상용 소프트웨어가 아니며 네트워크 기능이나 추가 보안 모듈을 포함하지 않습니다. 센서 모니터링, 밸브 제어, 자동 시퀀스를 하나의 창에서 처리하는 것이 핵심 목적입니다.

> ⚠️ **주의**
> - 실제 추진제와 하드웨어를 연결하기 전에 반드시 시뮬레이션 환경에서 충분히 테스트하세요.
> - 잘못된 설정이나 조작은 하드웨어 손상 또는 안전사고로 이어질 수 있습니다.
> - 이 프로젝트를 사용하는 모든 책임은 사용자에게 있습니다.

---

## 목차
1. [프로젝트 개요](#프로젝트-개요)
2. [주요 기능](#주요-기능)
3. [시스템 요구 사항](#시스템-요구-사항)
4. [설치 및 실행](#설치-및-실행)
5. [디렉터리 구조](#디렉터리-구조)
6. [주요 기술 스택](#주요-기술-스택)
7. [구성 요소와 작동 원리](#구성-요소와-작동-원리)
8. [설정 파일 구조](#설정-파일-구조-configjson)
9. [시리얼 통신 프로토콜](#시리얼-통신-프로토콜)
10. [데이터 로깅](#데이터-로깅)
11. [UI 사용 방법](#ui-사용-방법)
12. [품질 검사](#품질-검사)
13. [문제 해결](#문제-해결)
14. [자주 묻는 질문](#자주-묻는-질문)
15. [참고 문서](#참고-문서)

---

## 프로젝트 개요

이 프로젝트는 고로켓 팀의 실험용 액체 로켓 엔진을 제어하기 위해 제작되었습니다. 다음과 같은 특징이 있습니다.

- 하드웨어 제어 및 모니터링을 한 화면에서 수행
- Electron과 Next.js를 이용한 크로스 플랫폼 데스크톱 애플리케이션
- 시리얼 통신 기반으로 센서 데이터 수집 및 명령 전송
- 자동 점화/퍼지/비상 정지 시퀀스 지원

---

## 주요 기능

초보자도 쉽게 이해할 수 있도록 핵심 기능을 세부적으로 설명합니다.

- **실시간 센서 수집**
  - 압력 트랜스듀서 4개, 유량 센서 2개, 열전대 1개 등 다양한 센서에서 들어오는 값을 주기적으로 수집합니다.
  - 수집 주기는 하드웨어 성능에 따라 다르지만, 일반적으로 수백 밀리초 단위로 동작합니다.
  - 수집된 값은 대시보드와 그래프 패널에 즉시 표시됩니다.
- **밸브 제어**
  - 최대 7개의 서보 밸브를 개별적으로 열고 닫을 수 있습니다.
  - 각 밸브에는 리미트 스위치가 연결되어 있어 실제 물리 상태를 확인할 수 있습니다.
  - UI에서 버튼을 클릭하면 즉시 시리얼 명령이 하드웨어로 전송됩니다.
- **시퀀스 실행**
  - 점화, 퍼지, 비상 정지 시퀀스가 기본 제공됩니다.
  - 각 시퀀스는 시간 기반 단계 목록으로 구성되어 있으며, `SequencePanel`에서 실행 상황을 확인할 수 있습니다.
- **압력 한계 감시**
  - `config.json`에 정의된 `pressureLimit` 값을 초과하면 자동으로 Emergency Shutdown 시퀀스를 실행합니다.
  - 사용자 개입 없이도 위험 상황을 최소화하는 안전장치입니다.
- **데이터 시각화**
  - 최근 100초 동안의 압력·유량·온도 데이터를 `Recharts`를 이용해 라인 차트로 표시합니다.
  - 임계선이나 경보 영역을 그래프에 함께 표시하여 변화를 직관적으로 파악할 수 있습니다.
- **로그 터미널**
  - 송수신된 모든 시리얼 메시지와 시퀀스 진행 상황이 스크롤 가능한 로그 패널에 기록됩니다.
  - 문제 발생 시 원인을 추적할 수 있는 1차 자료로 활용됩니다.
- **화면 확대/축소**
  - `Ctrl` + 마우스 휠 또는 단축키(`Ctrl` + `=`, `Ctrl` + `-`, `Ctrl` + `0`)로 화면 배율을 조정합니다.
- **CSV 데이터 로깅**
  - 버튼으로 데이터 수집을 시작/종료하면 `Documents/rocket-log-YYYYMMDD-HHMMSS.csv` 형식의 파일로 센서 값을 저장합니다.
- **설정 파일 기반 매핑**
  - `config.json`에서 밸브 이름, 서보 인덱스, 그래프 샘플 수 등을 정의하며 앱 실행 시 자동으로 불러옵니다.

---

## 시스템 요구 사항

| 항목 | 권장 버전 |
| --- | --- |
| 운영 체제 | Windows 10+, macOS 13+, 최신 Linux 배포판 |
| Node.js | 20.x 이상 |
| npm | 10.x 이상 (Node 설치 시 포함) |
| 하드웨어 | 시리얼 통신이 가능한 USB 포트 |

> **팁**: Node.js가 설치되어 있는지 확인하려면 터미널에서 `node -v`와 `npm -v`를 입력해 버전을 확인합니다.

---

## 설치 및 실행

처음 프로젝트를 접하는 사용자를 위한 상세 가이드입니다.

1. **Node.js 설치**
   1. [Node.js 공식 사이트](https://nodejs.org/)에서 권장 LTS 버전을 다운로드합니다.
   2. 설치 마법사의 지시에 따라 설치를 완료합니다.
   3. 설치 후 터미널을 열고 `node -v`와 `npm -v` 명령으로 정상 설치 여부를 확인합니다.

2. **프로젝트 클론**
   ```bash
   git clone <레포지토리 URL>
   cd Gorocket-Control-System-GUI
   ```

3. **의존성 설치**
   ```bash
   npm install
   ```
   - 설치 과정에서 오류가 발생하면 네트워크 연결 상태를 확인하거나, 관리자 권한으로 실행해 보세요.

4. **개발 모드 실행**
   ```bash
   npm run dev
   ```
   - `next dev` 서버가 9002번 포트에서 실행되고, Electron이 자동으로 새 창을 엽니다.
   - 콘솔에 오류 메시지가 나타난다면 해당 내용을 참고하여 수정합니다.

5. **프로덕션 빌드 생성**
   ```bash
   npm run build
   ```
   - `dist/` 폴더에 실행 파일과 필요한 리소스가 생성됩니다.
   - 생성된 파일을 다른 PC로 옮기려면 `config.json`도 함께 복사해야 합니다.

6. **프로그램 실행**
   - 개발 모드: `npm run dev`
   - 빌드 후 실행: `electron .` 또는 생성된 실행 파일을 직접 실행

---

## 디렉터리 구조

프로젝트의 주요 폴더와 파일을 간단히 소개합니다. 각 폴더에는 관련된 추가 설명이 포함되어 있어 구조를 이해하기 쉽습니다.

```
.
├── main.ts             # Electron 메인 프로세스 진입점
├── preload.ts          # 렌더러에서 사용할 IPC 브리지
├── main/               # 메인 프로세스 모듈 (ConfigManager 등)
├── arduino_mega_code/  # 구동 장치용 아두이노 펌웨어
├── config.json         # 시리얼 및 밸브 매핑 설정
├── src/
│   ├── app/            # Next.js 엔트리 (layout.tsx, page.tsx, 전역 CSS)
│   ├── components/
│   │   ├── dashboard/  # 센서, 밸브, 시퀀스, 로그 등 패널 컴포넌트
│   │   └── ui/         # 버튼·카드 등 공용 UI 컴포넌트
│   ├── hooks/          # 커스텀 훅 (useSerialManager 등)
│   ├── lib/            # 공용 유틸 함수
│   ├── types/          # 전역 타입 및 IPC 인터페이스
│   └── utils/          # 센서 파서 등 기타 유틸
├── docs/blueprint.md   # 초기 설계 문서
└── package.json        # 스크립트 및 의존성 정의
```

각 폴더에 대한 간단한 설명:

- **main/**: Electron 메인 프로세스에서만 사용되는 모듈이 위치합니다.
- **src/app/**: Next.js의 루트 페이지와 전역 레이아웃을 포함합니다.
- **src/components/**: 대시보드 패널과 UI 컴포넌트가 모여 있습니다.
- **src/hooks/**: 상태 관리 및 시리얼 통신을 위한 커스텀 훅이 정의되어 있습니다.
- **src/types/**: 타입스크립트 타입 정의 파일을 모아 두었습니다.

---

## 주요 기술 스택

| 기술 | 용도 |
| --- | --- |
| **Electron** | 데스크톱 애플리케이션 프레임워크 |
| **Next.js** | React 기반 프레임워크로, 렌더링과 라우팅을 담당 |
| **TypeScript** | 정적 타입 언어로 코드 안정성을 향상 |
| **Tailwind CSS / shadcn/ui** | UI 스타일링 및 공용 컴포넌트 |
| **serialport** | 시리얼 통신 라이브러리 |
| **Recharts** | 센서 데이터를 시각화하는 그래프 라이브러리 |

---

## 구성 요소와 작동 원리

### 1. Electron 메인 프로세스 (`main.ts`)
- 앱 실행 시 `config.json`을 읽어 시리얼 통신 파라미터와 밸브 매핑 정보를 메모리에 로드합니다.
- `BrowserWindow`를 생성하여 Next.js로 빌드된 페이지를 띄우며, 개발 모드에서는 자동으로 DevTools를 엽니다.
- `serialport` 라이브러리를 사용해 포트 목록을 조회하고 연결/해제 및 오류 처리를 담당합니다.
- 수신된 시리얼 문자열을 렌더러에 전달하고, 렌더러가 보낸 명령을 검증 후 하드웨어에 전송합니다.
- `start-logging` / `stop-logging` IPC 이벤트로 CSV 파일을 열고 닫으며 센서 값을 기록합니다.
- 줌 인/줌 아웃/배율 초기화 이벤트를 처리해 렌더러 화면 배율을 제어합니다.

### 2. Preload 스크립트 (`preload.ts`)
- `contextBridge`를 통해 `window.electronAPI` 네임스페이스를 노출하여 렌더러가 Node 환경과 분리된 상태에서 IPC를 사용합니다.
- 제공 메서드: `getSerialPorts`, `connectSerial`, `disconnectSerial`, `sendToSerial`, `onSerialData`, `onSerialError`, `startLogging`, `stopLogging`, `getConfig`, `zoomIn/Out/Reset`, `onLogCreationFailed` 등.

### 3. Next.js 렌더러 (`src/app/page.tsx`)
- 시작 시 `getSerialPorts()`와 `getConfig()`를 호출하여 초기 상태를 준비합니다.
- `useSerialManager` 훅이 센서·밸브·시퀀스 상태를 통합 관리하며, 밸브 제어 시 `sendToSerial`을 통해 명령을 보냅니다.
- 로그 버튼을 누르면 `startLogging`/`stopLogging` IPC로 파일 스트림을 제어합니다.
- `SequencePanel`은 정의된 시퀀스를 실행하며, 압력 한계 초과 시 자동으로 `Emergency Shutdown`을 수행합니다.
- `DataChartPanel`은 최근 샘플을 `Recharts`로 렌더링하며 임계선도 표시합니다.
- `TerminalPanel`은 송수신 로그와 시퀀스 진행 상황을 실시간으로 보여 줍니다.

### 4. 커스텀 훅과 유틸
- `useSerialManager` : 포트 목록, 연결 상태, 센서·밸브 데이터를 통합 관리합니다.
- `useSequenceManager` : 점화·퍼지·비상 정지 등 자동 시퀀스를 정의하고 실행합니다.
- `useSensorData` / `useValveControl` : 수신 문자열을 파싱하고 밸브 상태를 업데이트합니다.
- `use-toast` : Shadcn UI 기반 토스트 알림을 제공합니다.
- `lib/utils.ts` : Tailwind 클래스 병합 함수 `cn` 등을 포함합니다.

---

## 설정 파일 구조 (`config.json`)

하드웨어 연결 정보와 밸브 매핑은 `config.json`에서 관리합니다. 예시는 다음과 같습니다.

```json
{
  "serial": { "baudRate": 115200 },
  "maxChartDataPoints": 100,
  "pressureLimit": 850,
  "initialValves": [
    { "id": 1, "name": "Ethanol Main", "state": "CLOSED" },
    { "id": 2, "name": "N2O Main", "state": "CLOSED" }
  ],
  "valveMappings": {
    "Ethanol Main": { "servoIndex": 0 },
    "N2O Main": { "servoIndex": 1 }
  }
}
```

각 항목의 의미:

- `serial.baudRate` : 시리얼 포트를 열 때 사용할 통신 속도입니다. 하드웨어와 동일한 값으로 설정해야 합니다.
- `maxChartDataPoints` : 그래프에 유지할 샘플 개수입니다. 값이 클수록 메모리 사용량이 증가합니다.
- `pressureLimit` : 압력이 이 값을 초과하면 자동으로 비상 정지 시퀀스를 실행합니다.
- `initialValves` : 앱 시작 시 표시될 밸브 목록과 초기 상태입니다. `state`는 `OPEN` 또는 `CLOSED`.
- `valveMappings` : UI에서 정의한 밸브 이름을 실제 서보 인덱스로 매핑합니다.

설정 파일을 수정한 후에는 앱을 다시 실행하거나 `Ctrl+R`로 새로고침해야 변경 사항이 반영됩니다.

---

## 시리얼 통신 프로토콜

| 목적 | 형식 | 예시 |
| --- | --- | --- |
| 밸브 제어 명령 | `V,서보인덱스,상태` | `V,0,O` → 0번 서보 밸브를 Open |
| 센서 데이터 수신 | `key:value` 쌍을 콤마로 구분 | `PT1:123.4,PT2:125.0` |

- 밸브 상태는 `O`(Open) 또는 `C`(Close)로 표현합니다.
- 애플리케이션은 수신된 문자열을 파싱하여 각 센서 값과 밸브 상태를 갱신합니다.
- 밸브와 서보 인덱스의 매핑은 `config.json`의 `valveMappings`에 정의됩니다.

---

## 데이터 로깅

- `Header`의 로그 버튼을 누르면 `startLogging` IPC 메시지를 보내 CSV 파일을 생성합니다.
- 파일은 `Documents/rocket-log-YYYYMMDD-HHMMSS.csv` 형식으로 저장됩니다.
- 로깅 중에는 수신한 센서 값이 CSV 포맷으로 파일에 추가되며, `stopLogging` 메시지로 파일 스트림을 닫습니다.
- 로그 생성 실패 시 `log-creation-failed` 이벤트가 렌더러로 전달되어 사용자에게 알림을 표시합니다.

예시 CSV 헤더:

```
timestamp,PT1,PT2,PT3,PT4,Flow1,Flow2,Thermo
```

---

## UI 사용 방법

1. **시리얼 포트 선택**
   - 앱 실행 후 상단의 포트 목록에서 연결 가능한 포트를 확인합니다.
   - 원하는 포트를 선택한 뒤 `Connect` 버튼을 클릭합니다.
2. **센서 확인**
   - `Dashboard` 패널에서 실시간으로 들어오는 압력, 유량, 온도 데이터를 확인합니다.
3. **밸브 제어**
   - `Valve` 패널에서 각 밸브의 버튼을 눌러 수동으로 열거나 닫을 수 있습니다.
   - 밸브가 실제로 동작하면 리미트 스위치 상태가 함께 표시됩니다.
4. **시퀀스 실행**
   - `Sequence` 패널에서 점화, 퍼지, 비상 정지 시퀀스를 선택하여 실행합니다.
   - 진행 상황은 로그 패널과 상태 표시줄에서 확인할 수 있습니다.
5. **로그 확인**
   - `Terminal` 패널에서 송수신된 모든 데이터와 시퀀스 진행 상황을 실시간으로 확인합니다.
6. **데이터 기록**
   - `Start Logging` 버튼을 눌러 데이터를 기록하고, 완료 시 `Stop Logging`을 클릭합니다.

---

## 품질 검사

코드를 수정한 후에는 다음 명령으로 정적 검사를 실행해 품질을 유지하세요.

```bash
npm run lint         # ESLint 실행
npm run typecheck    # TypeScript 타입 검사
```

---

## 문제 해결

- **시리얼 포트가 보이지 않는 경우**
  - 드라이버가 설치되어 있는지, 다른 프로그램이 포트를 점유하지 않았는지 확인합니다.
- **`npm run dev` 실행 시 에러가 발생하는 경우**
  - Node.js와 npm 버전이 권장 버전 이상인지 확인하고, `node_modules` 폴더를 삭제 후 다시 설치해 봅니다.
- **로그 파일이 생성되지 않는 경우**
  - 쓰기 권한이 있는지 확인하고, 경로에 한글이나 공백이 없는지 점검합니다.

---

## 자주 묻는 질문

- **Q. 이 프로그램은 네트워크를 통해 원격 제어가 가능한가요?**
  - A. 아니요. 모든 제어는 로컬 PC와 하드웨어가 직접 연결된 환경에서 이루어집니다.
- **Q. 다른 센서나 밸브를 추가하고 싶습니다. 어떻게 해야 하나요?**
  - A. `config.json`과 관련 훅/컴포넌트를 수정하여 새로운 항목을 정의한 뒤 빌드하면 됩니다.
- **Q. 시퀀스를 사용자 정의할 수 있나요?**
  - A. `useSequenceManager`의 로직을 수정하거나 새로운 시퀀스 함수를 추가하여 구현할 수 있습니다.

---

## 참고 문서

- `docs/blueprint.md`에 초기 요구사항과 디자인 가이드가 정리되어 있습니다.

---

이 README는 개발자가 데스크톱에서 안전하게 로켓 엔진을 제어할 수 있도록 현재 코드 구조와 사용 방법을 문서화한 것입니다. 배포판이 아니므로 보안·결함에 대한 책임은 사용자에게 있습니다.

