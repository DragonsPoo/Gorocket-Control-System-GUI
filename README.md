<img width="2879" height="1700" alt="image" src="https://github.com/user-attachments/assets/ff2199ca-45b7-43f5-a146-2680b53c5f0f" />

# GOROCKET Control Suite

`GOROCKET Control Suite`는 고로켓 팀이 개발 중인 **액체 로켓 엔진 시험대**를 제어하기 위해 만든 데스크톱 애플리케이션입니다. 이 프로그램은 USB를 통한 **유선 시리얼 통신**으로 센서를 읽고 밸브를 제어하며, 점화와 퍼지 같은 자동 시퀀스를 실행합니다. 네트워크 기능이나 인증 모듈이 없는 순수 개발용 도구이므로, **실험실·개인 PC 환경에서만 사용**해야 합니다.

> ⚠️ **안전 안내**
> - 실제 추진제를 사용하기 전에 반드시 모의 장비로 충분히 연습하세요.
> - 잘못된 설정이나 부주의한 조작은 하드웨어 파손 및 안전사고로 이어질 수 있습니다.
> - 본 프로젝트의 사용으로 인한 모든 책임은 사용자에게 있습니다.

---

## 목차

1. [프로젝트 소개](#프로젝트-소개)
2. [빠른 시작](#빠른-시작)
3. [시스템 요구 사항](#시스템-요구-사항)
4. [설치와 실행](#설치와-실행)
5. [디렉터리 구조](#디렉터리-구조)
6. [주요 기술 스택](#주요-기술-스택)
7. [구성 요소와 작동 원리](#구성-요소와-작동-원리)
8. [설정 파일 상세 (`config.json`)](#설정-파일-상세-configjson)
9. [시리얼 통신 프로토콜](#시리얼-통신-프로토콜)
10. [데이터 로깅](#데이터-로깅)
11. [UI 사용 방법](#ui-사용-방법)
12. [품질 검사와 빌드](#품질-검사와-빌드)
13. [문제 해결](#문제-해결)
14. [자주 묻는 질문](#자주-묻는-질문)
15. [참고 문서 및 라이선스](#참고-문서-및-라이선스)

---

## 프로젝트 소개

이 프로그램은 **센서 모니터링·밸브 제어·자동 시퀀스 실행**을 한 화면에서 수행할 수 있도록 설계되었습니다. 핵심 특징은 다음과 같습니다.

- Electron과 Next.js 기반으로 Windows, macOS, Linux에서 동일한 인터페이스 제공
- 최대 4개의 압력 센서, 2개의 유량 센서, 1개의 열전대 등 다양한 계측값 표시
- 점화, 퍼지, 비상 정지(E‑Stop)와 같은 시퀀스를 시간 순서대로 자동 실행
- CSV 형식으로 데이터 로깅 가능

프로그램은 단순히 **시리얼 포트를 통해 텍스트 기반 명령을 송수신**합니다. 하드웨어 제어 로직은 `arduino_mega_code` 폴더에 포함된 펌웨어에 구현되어 있으며, 이 프로젝트는 사용자 인터페이스와 시리얼 통신을 담당합니다.

---

## 빠른 시작

처음 프로젝트를 접하는 사용자를 위해 최소한의 단계만 요약했습니다.

1. [시스템 요구 사항](#시스템-요구-사항)을 만족하는지 확인합니다.
2. 저장소를 클론하고 의존성을 설치합니다.
3. `npm run dev`로 개발 서버를 실행하면 Electron 창이 자동으로 열립니다.
4. 상단 메뉴에서 시리얼 포트를 선택하고 `Connect` 버튼을 눌러 하드웨어와 연결합니다.
5. 센서 값과 밸브 상태가 정상적으로 표시되는지 확인한 뒤 실험을 진행합니다.

아래 섹션들은 각 단계에 대한 자세한 설명을 제공합니다.

---

## 시스템 요구 사항

| 구분 | 권장 사양 |
| --- | --- |
| **운영 체제** | Windows 10 이상, macOS 13 이상, 최신 Linux 배포판 |
| **Node.js** | 20.x 이상 |
| **npm** | 10.x 이상 (Node 설치 시 자동 포함) |
| **하드웨어** | 시리얼 통신이 가능한 USB 포트 및 케이블 |

> **Tip**: 터미널에서 `node -v`와 `npm -v` 명령을 입력해 버전을 확인할 수 있습니다. 설치가 되어 있지 않다면 [Node.js 공식 사이트](https://nodejs.org/)에서 LTS 버전을 내려받아 설치하세요.

---

## 설치와 실행

프로젝트를 로컬에서 실행하기 위한 전체 과정을 상세하게 설명합니다.

### 1. 저장소 클론

```bash
git clone <레포지토리 URL>
cd Gorocket-Control-System-GUI
```

Git이 설치되어 있지 않다면 [Git 공식 페이지](https://git-scm.com/)에서 설치 후 다시 시도합니다.

### 2. 의존성 설치

```bash
npm install
```

- 네트워크 속도에 따라 몇 분이 걸릴 수 있습니다.
- 권한 문제로 설치가 실패한다면 관리자 권한(Windows)이나 `sudo`(macOS/Linux)로 다시 실행해 보세요.

### 3. 개발 모드 실행

```bash
npm run dev
```

- 9002번 포트에서 Next.js 개발 서버가 실행되고, Electron이 자동으로 새 창을 띄웁니다.
- 콘솔에 오류가 보인다면 메시지를 잘 읽고 `node_modules`를 삭제한 뒤 다시 설치해 보세요.

### 4. 프로덕션 빌드 생성

```bash
npm run build
```

- `dist/` 폴더에 배포용 실행 파일과 필요한 리소스가 생성됩니다.
- 생성된 파일을 다른 컴퓨터에서 실행하려면 `config.json`도 함께 복사해야 합니다.

### 5. 빌드된 앱 실행

```bash
electron .   # 또는 dist 폴더의 실행 파일을 직접 실행
```

---

## 디렉터리 구조

```text
.
├── main.ts             # Electron 메인 프로세스 진입점
├── preload.ts          # 렌더러에서 IPC를 사용할 수 있게 해주는 브리지
├── main/               # 메인 프로세스 모듈 (ConfigManager 등)
├── arduino_mega_code/  # 하드웨어 제어용 아두이노 코드
├── config.json         # 시리얼 설정 및 밸브 매핑 정보
├── src/
│   ├── app/            # Next.js 엔트리 (layout.tsx, page.tsx 등)
│   ├── components/     # 대시보드·UI 컴포넌트 모음
│   ├── hooks/          # 커스텀 훅 (예: useSerialManager)
│   ├── lib/            # 공통 유틸 함수
│   ├── types/          # 타입스크립트 타입 정의
│   └── utils/          # 파서 등 기타 유틸
├── docs/blueprint.md   # 초기 설계 문서
└── package.json        # 스크립트 및 의존성 정의
```

각 폴더는 명확한 역할을 갖고 있습니다. 예를 들어 `main/` 폴더는 Electron의 메인 프로세스에서만 사용되는 모듈을 담고 있으며, `src/` 이하에는 화면에 표시되는 모든 React 컴포넌트가 위치합니다.

---

## 주요 기술 스택

| 기술 | 설명 |
| --- | --- |
| **Electron** | 웹 기술로 데스크톱 앱을 제작하기 위한 프레임워크 |
| **Next.js** | React 기반의 프레임워크로 라우팅과 빌드를 담당 |
| **TypeScript** | 정적 타입을 제공하여 런타임 오류를 감소 |
| **Tailwind CSS / shadcn/ui** | 빠른 스타일링과 일관된 UI 컴포넌트 제공 |
| **serialport** | Node.js 환경에서 시리얼 통신을 수행 |
| **Recharts** | 센서 데이터를 시각화하는 차트 라이브러리 |

---

## 구성 요소와 작동 원리

### 1. Electron 메인 프로세스 (`main.ts`)

- 앱 시작 시 `config.json`을 읽어 포트 속도, 밸브 매핑 등의 설정을 메모리에 적재합니다.
- 시리얼 포트를 열고 닫는 기능, 데이터 수신 처리, CSV 파일 생성 등 **하드웨어와 직접 상호작용**하는 로직이 위치합니다.
- 렌더러에서 보내는 명령을 검증한 후 실제 하드웨어로 전달합니다.

### 2. Preload 스크립트 (`preload.ts`)

- `contextBridge`를 사용하여 `window.electronAPI` 객체를 브라우저 영역에 노출합니다.
- 렌더러가 Node 기능에 직접 접근하지 않고도 IPC 통신을 사용할 수 있도록 돕습니다.

### 3. Next.js 렌더러 (`src/app/page.tsx`)

- 사용자에게 보이는 모든 화면을 구성합니다.
- `useSerialManager` 훅이 센서 값, 밸브 상태, 시퀀스 진행 상황을 통합 관리합니다.
- `SequencePanel`, `DataChartPanel`, `TerminalPanel` 등 여러 패널로 나누어 정보를 표시합니다.

### 4. 커스텀 훅과 유틸

- `useSerialManager` : 포트 목록 조회, 연결 상태, 수신 데이터 처리 등 핵심 로직을 담당합니다.
- `useSequenceManager` : 점화·퍼지·비상 정지 시퀀스를 시간 순서대로 실행합니다.
- `lib/utils.ts` : Tailwind 클래스 병합 등 재사용 가능한 유틸 함수를 제공합니다.

---

## 설정 파일 상세 (`config.json`)

앱의 동작 방식은 대부분 `config.json` 파일에서 정의됩니다. 예시는 다음과 같습니다.

```json
{
  "serial": { "baudRate": 115200 },
  "maxChartDataPoints": 100,
  "pressureLimit": 850,
  "initialValves": [
    { "id": 1, "name": "Ethanol Main", "state": "CLOSED" },
    { "id": 2, "name": "N2O Main", "state": "CLOSED" }
  ],
  "valveMappings": {
    "Ethanol Main": { "servoIndex": 0 },
    "N2O Main": { "servoIndex": 1 }
  }
}
```

각 항목은 다음 의미를 갖습니다.

- `serial.baudRate` : 시리얼 포트 통신 속도. 하드웨어와 동일하게 맞춰야 합니다.
- `maxChartDataPoints` : 그래프에 유지할 최대 샘플 수.
- `pressureLimit` : 이 값을 초과하면 자동으로 비상 정지 시퀀스가 실행됩니다.
- `initialValves` : 앱 실행 시 표시할 밸브 목록과 초기 상태.
- `valveMappings` : UI에서 정의한 밸브 이름을 실제 서보 인덱스로 매핑합니다.

파일을 수정한 뒤에는 애플리케이션을 다시 시작하거나 `Ctrl+R`로 새로고침해야 변경 내용이 적용됩니다.

---

## 시리얼 통신 프로토콜

하드웨어와의 통신은 단순한 텍스트 기반 프로토콜을 사용합니다.

| 목적 | 형식 | 예시 |
| --- | --- | --- |
| **밸브 제어 명령** | `V,서보인덱스,상태` | `V,0,O` → 0번 서보를 Open |
| **센서 데이터 수신** | `key:value` 쌍을 콤마로 구분 | `PT1:123.4,PT2:125.0` |

- 밸브 상태는 `O`(Open) 또는 `C`(Close)로 표현합니다.
- 받은 문자열은 파싱하여 각 센서 값과 밸브 상태를 갱신합니다.
- 밸브와 서보 인덱스 매핑은 `config.json`에서 확인할 수 있습니다.

---

## 데이터 로깅

- 상단 `Start Logging` 버튼을 누르면 `Documents/rocket-log-YYYYMMDD-HHMMSS.csv` 형식의 파일이 생성됩니다.
- 로깅 중에는 수신한 센서 값이 실시간으로 CSV 파일에 추가됩니다.
- `Stop Logging`을 누르거나 프로그램을 종료하면 파일 스트림이 닫힙니다.
- 파일 생성에 실패하면 `log-creation-failed` 이벤트가 발생하며 화면에 오류 메시지가 표시됩니다.

CSV 파일의 첫 줄(헤더)은 다음과 같은 형태입니다.

```
timestamp,PT1,PT2,PT3,PT4,Flow1,Flow2,Thermo
```

---

## UI 사용 방법

1. **시리얼 포트 선택 및 연결**
   - 앱 실행 후 상단 드롭다운에서 사용 가능한 포트를 확인합니다.
   - 원하는 포트를 선택하고 `Connect` 버튼을 누르면 연결 상태가 `Connected`로 바뀝니다.

2. **센서 데이터 확인**
   - `Dashboard` 패널에서 각 센서의 현재 값을 숫자와 그래프로 확인할 수 있습니다.
   - 값이 비정상적으로 보인다면 즉시 하드웨어를 점검하세요.

3. **밸브 제어**
   - `Valve` 패널의 버튼을 클릭하면 해당 밸브를 열거나 닫을 수 있습니다.
   - 밸브 옆의 표시등은 리미트 스위치 상태를 나타냅니다.

4. **자동 시퀀스 실행**
   - `Sequence` 패널에서 점화(Ignition), 퍼지(Purge), 비상 정지(E‑Stop) 중 하나를 선택해 실행합니다.
   - 진행 상황은 로그 패널과 상태 표시줄에 시간 순으로 기록됩니다.

5. **로그 터미널 사용**
   - `Terminal` 패널에는 송수신된 모든 시리얼 문자열과 시퀀스 상태가 표시됩니다.
   - 문제 발생 시 이 로그를 참고해 원인을 추적할 수 있습니다.

6. **데이터 기록**
   - `Start Logging` 버튼을 눌러 CSV 파일 작성을 시작하고, 완료 후 `Stop Logging`을 클릭합니다.

7. **화면 확대/축소**
   - `Ctrl` + 마우스 휠, `Ctrl` + `=`/`-`/`0` 단축키로 배율을 조정할 수 있습니다.

---

## 품질 검사와 빌드

코드를 수정한 후 아래 명령을 실행하여 품질을 확인하세요.

```bash
npm run lint         # ESLint 규칙 검사
npm run typecheck    # TypeScript 타입 검사
```

검사가 통과하면 `npm run build`로 배포용 파일을 생성할 수 있습니다.

---

## 문제 해결

- **시리얼 포트가 표시되지 않음**
  - 드라이버 설치 여부를 확인하고, 다른 프로그램이 포트를 사용 중인지 체크합니다.
- **`npm run dev` 실행 시 오류 발생**
  - Node.js와 npm 버전이 요구 사항을 만족하는지 확인한 뒤 `node_modules`와 `package-lock.json`을 삭제하고 다시 설치합니다.
- **로그 파일이 생성되지 않음**
  - 쓰기 권한이 있는 경로인지 확인하고, 경로에 한글이나 공백이 없는지 점검합니다.
- **Electron 창이 열리지 않음**
  - `DISPLAY` 환경 변수 설정(Linux) 또는 보안 소프트웨어의 차단 여부를 확인하세요.

---

## 자주 묻는 질문

- **Q. 원격 제어나 네트워크 기능을 지원하나요?**
  - A. 현재 버전은 로컬 시리얼 연결만 지원하며 네트워크를 통한 제어는 제공하지 않습니다.
- **Q. 새로운 센서나 밸브를 추가하려면 어떻게 하나요?**
  - A. `config.json`에 항목을 추가하고 관련 훅 및 컴포넌트를 수정한 뒤 다시 빌드하면 됩니다.
- **Q. 자동 시퀀스를 사용자 정의할 수 있나요?**
  - A. `useSequenceManager` 로직을 참고하여 새로운 시퀀스를 작성하면 커스텀 시나리오를 구현할 수 있습니다.

---

## 참고 문서 및 라이선스

- `docs/blueprint.md`에 초기 요구 사항과 디자인 가이드가 정리되어 있습니다.
- 소스 코드는 [MIT 라이선스](LICENSE)에 따라 자유롭게 사용할 수 있습니다. 단, 실사용에 따른 책임은 전적으로 사용자에게 있습니다.

---

이 README는 액체 로켓 엔진 제어 시스템을 처음 접하는 개발자도 빠르게 이해하고 사용할 수 있도록 작성되었습니다. 문서를 참고하여 안전하고 효율적인 실험 환경을 구축하시기 바랍니다.

