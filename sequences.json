{
  "Emergency Shutdown": [
    {
      "message": "Immediate safe state (close mains, open vents, stop pressurization)",
      "delay": 0,
      "commands": [
        "CMD,Ethanol Main Supply,Close",
        "CMD,N2O Main Supply,Close",
        "CMD,Main Pressurization,Close",
        "CMD,Ethanol Fill Line,Close",
        "CMD,System Vent 1,Open",
        "CMD,System Vent 2,Open",
        "CMD,Ethanol Purge Line,Open"
      ]
    }
  ],

  "Random Test (6 valves, no #7)": [
    { "message": "V0 Open", "delay": 0,   "commands": ["V,0,O"] },
    { "message": "V1 Open", "delay": 800, "commands": ["V,1,O"] },
    { "message": "V0 Close","delay": 700, "commands": ["V,0,C"] },
    { "message": "V2 Open", "delay": 500, "commands": ["V,2,O"] },
    { "message": "V5 Open", "delay": 900, "commands": ["V,5,O"] },
    { "message": "V2 Close","delay": 600, "commands": ["V,2,C"] },
    { "message": "V4 Open", "delay": 700, "commands": ["V,4,O"] },
    { "message": "V1 Close","delay": 400, "commands": ["V,1,C"] },
    { "message": "V3 Open", "delay": 900, "commands": ["V,3,O"] },
    { "message": "V3 Close","delay": 600, "commands": ["V,3,C"] },
    { "message": "V4 Close","delay": 500, "commands": ["V,4,C"] },
    { "message": "V5 Close","delay": 800, "commands": ["V,5,C"] }
  ],

  "Random Test (7 valves, all)": [
    { "message": "V6 Open", "delay": 0,   "commands": ["V,6,O"] },
    { "message": "V0 Open", "delay": 700, "commands": ["V,0,O"] },
    { "message": "V6 Close","delay": 600, "commands": ["V,6,C"] },
    { "message": "V4 Open", "delay": 500, "commands": ["V,4,O"] },
    { "message": "V1 Open", "delay": 900, "commands": ["V,1,O"] },
    { "message": "V0 Close","delay": 700, "commands": ["V,0,C"] },
    { "message": "V5 Open", "delay": 600, "commands": ["V,5,O"] },
    { "message": "V1 Close","delay": 500, "commands": ["V,1,C"] },
    { "message": "V3 Open", "delay": 800, "commands": ["V,3,O"] },
    { "message": "V4 Close","delay": 600, "commands": ["V,4,C"] },
    { "message": "V2 Open", "delay": 500, "commands": ["V,2,O"] },
    { "message": "V2 Close","delay": 700, "commands": ["V,2,C"] },
    { "message": "V5 Close","delay": 600, "commands": ["V,5,C"] },
    { "message": "V3 Close","delay": 500, "commands": ["V,3,C"] }
  ],

  "Pre-Operation Safe Init": [
    {
      "message": "Ensure all valves closed (baseline safe state)",
      "delay": 0,
      "commands": [
        "CMD,Ethanol Main Supply,Close",
        "CMD,N2O Main Supply,Close",
        "CMD,Ethanol Purge Line,Close",
        "CMD,Ethanol Fill Line,Close",
        "CMD,Main Pressurization,Close",
        "CMD,System Vent 1,Close",
        "CMD,System Vent 2,Close"
      ]
    }
  ],


  "Pre-Test Nitrogen Purge": [
    {
      "message": "Set PR1 to 5 psig low pressure",
      "delay": 0,
      "commands": []
    },
    {
      "message": "Open main pressurization for N2 purge",
      "delay": 0,
      "commands": ["CMD,Main Pressurization,Open"]
    },
    {
      "message": "Open purge line for N2 flow",
      "delay": 0,
      "commands": [
        "CMD,Ethanol Purge Line,Open"
      ]
    },
    {
      "message": "Open ethanol fill line for purge",
      "delay": 100,
      "commands": [
        "CMD,Ethanol Fill Line,Open"
      ]
    },
    {
      "message": "Open vent valves for purge exit",
      "delay": 100,
      "commands": [
        "CMD,System Vent 1,Open",
        "CMD,System Vent 2,Open"
      ]
    },
    {
      "message": "N2 purge for 20+ seconds",
      "delay": 20000,
      "commands": []
    },
    {
      "message": "Close all valves to seal system",
      "delay": 0,
      "commands": [
        "CMD,Main Pressurization,Close",
        "CMD,Ethanol Fill Line,Close",
        "CMD,Ethanol Purge Line,Close",
        "CMD,System Vent 1,Close",
        "CMD,System Vent 2,Close"
      ]
    }
  ],

  "System Pressurization (600 psi)": [
    {
      "message": "Set PR1 to 600 psi final pressure",
      "delay": 0,
      "commands": []
    },
    {
      "message": "Open main pressurization line",
      "delay": 0,
      "commands": ["CMD,Main Pressurization,Open"]
    },
    {
      "message": "Wait for PT1 to reach 600 psi",
      "delay": 0,
      "commands": [],
      "condition": { "sensor": "pt1", "min": 580, "op": "gte", "timeoutMs": 120000 }
    },
    {
      "message": "System pressurized - ready for hot-fire",
      "delay": 2000,
      "commands": []
    }
  ],

  "Hot-Fire Sequence": [
    {
      "message": "Ensure oxidizer line closed",
      "delay": 0,
      "commands": ["CMD,N2O Main Supply,Close"]
    },
    {
      "message": "Fuel lead - Open ethanol supply first",
      "delay": 0,
      "commands": ["CMD,Ethanol Main Supply,Open"]
    },
    {
      "message": "Fuel lead time (0.1-0.2s)",
      "delay": 150,
      "commands": []
    },
    {
      "message": "Ignition - Open N2O supply",
      "delay": 0,
      "commands": ["CMD,N2O Main Supply,Open"]
    },
    {
      "message": "Main burn phase (2+ seconds)",
      "delay": 2000,
      "commands": []
    },
    {
      "message": "Shutdown - Close oxidizer first",
      "delay": 0,
      "commands": ["CMD,N2O Main Supply,Close"]
    },
    {
      "message": "Delay before closing fuel",
      "delay": 100,
      "commands": []
    },
    {
      "message": "Close fuel supply",
      "delay": 0,
      "commands": ["CMD,Ethanol Main Supply,Close"]
    }
  ],

  "Post-Test Safing": [
    {
      "message": "Immediate line purge - Open ethanol purge",
      "delay": 0,
      "commands": ["CMD,Ethanol Purge Line,Open"]
    },
    {
      "message": "Purge engine lines with N2",
      "delay": 3000,
      "commands": []
    },
    {
      "message": "Open vent valves for pressure relief",
      "delay": 0,
      "commands": [
        "CMD,System Vent 1,Open",
        "CMD,System Vent 2,Open"
      ]
    },
    {
      "message": "Wait for complete pressure relief (pt1 <= 15 psi)",
      "delay": 0,
      "commands": [],
      "condition": { "sensor": "pt1", "min": 0, "max": 15, "op": "lte", "timeoutMs": 60000 }
    },
    {
      "message": "Wait for complete pressure relief (pt2 <= 15 psi)",
      "delay": 0,
      "commands": [],
      "condition": { "sensor": "pt2", "min": 0, "max": 15, "op": "lte", "timeoutMs": 60000 }
    },
    {
      "message": "Close all valves and shut down system",
      "delay": 0,
      "commands": [
        "CMD,Main Pressurization,Close",
        "CMD,Ethanol Main Supply,Close",
        "CMD,N2O Main Supply,Close",
        "CMD,Ethanol Fill Line,Close",
        "CMD,Ethanol Purge Line,Close",
        "CMD,System Vent 1,Close",
        "CMD,System Vent 2,Close"
      ]
    },
    {
      "message": "System safed - power down complete",
      "delay": 1000,
      "commands": []
    }
  ]
}
